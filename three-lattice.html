<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="three-material.html">
<link rel="import" href="three-geometry.html">

<dom-module id="three-lattice">
  <template>
    <three-geometry
      data="[[data]]"
      object="{{geometry}}"
      center="{{geometryCenter}}"
      radius="{{geometryRadius}}"
      contour-by="{{contourBy}}">
    </three-geometry>
    <three-material id="material" object="{{material}}" color="{{color}}"></three-material>
  </template>
  <script>
    class ThreeLattice extends Polymer.Element {

      static get is() {
        return 'three-lattice';
      }

      static get properties() {
        return {
          color: String,
          data: Array,
          material: Object,
          geometryCenter: Array,
          geometryRadius: Number,
          contourBy: String,
          object: {
            type: Object,
            computed: '_computeObject(geometry, material)',
            observer: '_objectChanged',
          },
        }
      }

      static get observers() {
        return [
          '_geometryChanged(geometryRadius, geometryCenter)',
        ]
      }

      _computeObject(geometry, material) {
//        console.log('_computeObject');
        if (!(geometry && material)) return;
        return new THREE.Mesh(geometry, material);
      }

      _geometryChanged(geometryRadius, geometryCenter) {
//        console.log('_geometryChanged', this.geometry);
        if (!(geometryRadius && geometryCenter)) return;
        const eventInitDict = {
          bubbles: true,
          detail: {geometryRadius: this.geometryRadius, geometryCenter: this.geometryCenter}
        };
        this.dispatchEvent(new CustomEvent('lattice-geometry-changed', eventInitDict));
      }

      _objectChanged(newObject, oldObject) {
        const eventInitDict = {bubbles: true, detail: {object: newObject}};
        this.dispatchEvent(new CustomEvent('lattice-changed', eventInitDict));
      }
    }

    customElements.define(ThreeLattice.is, ThreeLattice);
  </script>
</dom-module>