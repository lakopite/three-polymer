<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="three-camera">
  <script>
    class ThreeCamera extends Polymer.Element {

      static get is() {
        return 'three-camera'
      }

      static get properties() {
        return {
          targetPosition: {type: Array, value: [0, 0, 0]},
          geometryRadius: {type: Number, value: -0},
          position: {
            type: Array,
            computed: '_computePosition(targetPosition, geometryRadius)',
            observer: '_positionChanged',
          },
          distanceToTarget: {
            type: Number,
            computed: '_computeDistanceToTarget(position, targetPosition)',
          },
          frustum: {
            type: Array,
            computed: '_computeFrustum(geometryRadius, distanceToTarget)'
          },
          object: {
            type: Object,
            computed: '_computeCamera(frustum)',
            notify: true,
          },
        }
      }

      _computePosition(targetPosition, geometryRadius) {
        return [targetPosition[0], -2.5 * geometryRadius, targetPosition[2]];
      }

      _computeDistanceToTarget(position, targetPosition) {
        let v1 = new THREE.Vector3(...position);
        let v2 = new THREE.Vector3(...targetPosition);
        return v1.distanceTo(v2);
      }

      _computeFrustum(geometryRadius, distanceToTarget) {
        return [
          geometryRadius * -1.5,
          geometryRadius * 1.5,
          geometryRadius * 1.5,
          geometryRadius * -1.5,
          distanceToTarget - 2 * geometryRadius,
          distanceToTarget + 2 * geometryRadius
        ];
      }

      _computeCamera(frustum) {
        let camera = new THREE.OrthographicCamera(...frustum);
        camera.up = new THREE.Vector3(0, 0, 1);
        return camera;
      }

      _positionChanged(newPosition) {
        this.object.position.set(...newPosition);
        this.object.updateProjectionMatrix();
      }

    }

    customElements.define(ThreeCamera.is, ThreeCamera);
  </script>
</dom-module>